<!DOCTYPE html>
<html>
  <head>
    <title>Promises</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans", sans-serif;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col">
    <header
      class="bg-black text-white w-full p-4 flex justify-between items-center"
    >
      <div class="text-xl font-bold text-white-200 bg-clip-text text-3xl">
        정치인 공약 이행률
      </div>
      <div>
        <input
          type="text"
          id="searchInput"
          placeholder="Search..."
          class="p-2 text-black rounded"
        />
        <select id="results" class="p-2 text-black rounded">
          <!-- 드롭다운 옵션들이 여기에 추가될 것입니다 -->
        </select>
        <button
          id="searchButton"
          class="bg-gray-700 text-white p-2 rounded ml-2"
        >
          Search
        </button>
      </div>
    </header>

    <div class="flex-1 bg-gray-100 dark:bg-gray-800 p-10 md:p-6 lg:p-40">
      <div class="grid gap-6">
        <div class="flex items-center gap-6">
          <img src="../src/hong.jpg" class="w-20 h-30 rounded shadow" />
          <div class="mr-auto">
            <h2 class="text-2xl font-bold">{{ name }}</h2>
            <p>{{ region }}</p>
            <!--<p class="mb-4">ID: {{ id }}</p>-->
          </div>
          <div class="text-5xl font-bold">{{total_fulfillment_rate}}%</div>
        </div>
        <h4 class="text-xl font-bold md:text-left">공약 리스트</h4>

        <ul class="bg-white space-y-4 p-6">
          {% for promise in promises %}
          <li class="border-b pb-2 flex items-center">
            <p class="text-gray-700 mr-auto">{{ promise.description }}</p>
            <p class="text-gray-500">
              <strong>{{ promise.status }}</strong>
            </p>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <select id="politicianDropdown" class="p-2 text-black rounded">
      <option value="" selected disabled hidden>Select a politician</option>
    </select>

    <script>
      document
        .getElementById("searchButton")
        .addEventListener("click", function () {
          const searchQuery = document.getElementById("searchInput").value;

          fetch(`/politicians/search/?q=${encodeURIComponent(searchQuery)}`)
            .then((response) => response.json())
            .then((data) => {
              const dropdown = document.getElementById("politicianDropdown");
              dropdown.innerHTML = ""; // 이전 검색 결과를 지웁니다

              data.forEach((item) => {
                const option = document.createElement("option");
                option.textContent = item[0]; // 정치인의 이름으로 표시
                option.value = item[1]; // 정치인의 ID를 value로 설정
                dropdown.appendChild(option);
              });
            })
            .catch((error) => console.error("Error:", error));
        });

      // 드롭다운 메뉴에서 항목을 선택할 때의 이벤트 리스너
      document
        .getElementById("politicianDropdown")
        .addEventListener("change", function () {
          const selectedPoliticianId = this.value; // 선택된 정치인의 ID
          if (selectedPoliticianId) {
            // 선택된 정치인의 ID를 사용하여 해당 정치인의 페이지로 이동
            window.location.href = `/promises/${selectedPoliticianId}`;
          }
        });
    </script>
  </body>
</html>
